<% layout('layouts/main', { title, siteName, user, VAPID_PUBLIC_KEY }) %>

<h1>User Management</h1>

<!-- Search and filters -->
<div class="users-filters">
    <form method="GET">
        <input type="text" name="search" placeholder="Search by username or email" 
               value="<%= filters.search || '' %>">
        <select name="role">
            <option value="">All Roles</option>
            <% roles.forEach(role => { %>
                <option value="<%= role %>" <%= filters.role === role ? 'selected' : '' %>>
                    <%= role.charAt(0).toUpperCase() + role.slice(1) %>
                </option>
            <% }) %>
        </select>
        <button type="submit">Filter</button>
    </form>
</div>

<!-- Users table -->
<div class="users-table">
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Plan</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if (users.length === 0) { %>
                <tr>
                    <td colspan="6">No users found</td>
                </tr>
            <% } else { %>
                <% users.forEach(u => { %>
                    <tr>
                        <td><%= u.username %></td>
                        <td><%= u.email %></td>
                        <td><%= u.role %></td>
                        <td><%= u.planId ? u.planId.name : 'No Plan' %></td>
                        <td><%= u.createdAt.toLocaleDateString() %></td>
                        <td>
                            <button onclick="editUser('<%= u._id %>')">Edit</button>
                            <button onclick="deleteUser('<%= u._id %>')">Delete</button>
                        </td>
                    </tr>
                <% }) %>
            <% } %>
        </tbody>
    </table>
</div>

<!-- Pagination -->
<% if (pagination.pages > 1) { %>
    <div class="pagination">
        <% for (let i = 1; i <= pagination.pages; i++) { %>
            <a href="?page=<%= i %>&role=<%= filters.role || '' %>&search=<%= filters.search || '' %>" 
               class="<%= pagination.page === i ? 'active' : '' %>">
                <%= i %>
            </a>
        <% } %>
    </div>
<% } %>

<script>
function editUser(userId) {
    alert('Edit user functionality coming soon!');
}

function deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
        // Implement delete functionality
        alert('Delete user functionality coming soon!');
    }
}
</script>
